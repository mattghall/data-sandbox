<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coding Interview Prep</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/csharp.min.js"></script>
    
    <style>
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-orange: #f0883e;
            --accent-blue: #7dd3fc;
            --accent-cyan: #a5f3fc;
            --error-red: #f85149;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
        }

        .header {
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 0.5rem 0;
        }

        .title {
            color: var(--accent-orange);
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 0;
        }

        .controls {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1100;
            background-color: var(--bg-tertiary);
            padding: 0.75rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .mode-display {
            color: var(--accent-orange);
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }

        .help-text {
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
        }

        .status {
            color: var(--text-secondary);
            font-size: 0.7rem;
        }

        .content-container {
            padding: 0.5rem;
        }

        .language-headers {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
            position: sticky;
            top: 60px;
            background-color: var(--bg-primary);
            z-index: 100;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--bg-tertiary);
        }

        .language-header {
            color: var(--accent-orange);
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            padding: 0.5rem;
            background-color: var(--bg-secondary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }

        .section-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            overflow: hidden;
        }

        .section-header {
            grid-column: 1 / -1;
            background-color: var(--bg-tertiary);
            color: var(--accent-orange);
            font-size: 1.1rem;
            font-weight: bold;
            padding: 0.5rem;
            text-align: center;
            border-bottom: 1px solid var(--border-color);
        }

        .section-content {
            padding: 0.75rem;
            background-color: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            min-height: 120px;
        }

        .section-content:last-child {
            border-right: none;
        }

        .section-content.hidden {
            display: none;
        }

        .markdown-content h1 {
            color: var(--accent-orange);
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
            border-bottom: 1px solid var(--bg-tertiary);
            padding-bottom: 0.25rem;
        }

        .markdown-content h2 {
            color: var(--accent-blue);
            font-size: 1.2rem;
            margin: 1rem 0 0.5rem 0;
        }

        .markdown-content h3 {
            color: var(--accent-cyan);
            font-size: 1rem;
            margin: 0.75rem 0 0.5rem 0;
        }

        .markdown-content p {
            margin-bottom: 0.5rem;
        }

        .markdown-content pre {
            background-color: var(--bg-secondary) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 4px !important;
            padding: 0.5rem !important;
            margin: 0.5rem 0 !important;
            overflow-x: auto;
        }

        .markdown-content code {
            background-color: var(--bg-secondary);
            color: var(--error-red);
            padding: 1px 3px;
            border-radius: 2px;
            font-size: 0.85em;
        }

        .markdown-content pre code {
            background-color: transparent;
            color: var(--text-primary);
            padding: 0;
            font-size: 0.8rem;
        }

        .content-container::-webkit-scrollbar {
            width: 8px;
        }

        .content-container::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .content-container::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .content-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 200px;
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .error {
            background-color: #2d1117;
            border: 1px solid var(--error-red);
            border-radius: 8px;
            padding: 1.5rem;
            margin: 2rem;
            color: var(--error-red);
        }

        .error h3 {
            margin-bottom: 1rem;
        }

        .error ul {
            margin-left: 1.5rem;
            margin-top: 0.5rem;
        }

        /* Single column mode */
        .mode-single .section-row {
            grid-template-columns: 1fr;
        }

        .mode-single .language-headers {
            grid-template-columns: 1fr;
        }

        .mode-single .language-header:not(.active) {
            display: none;
        }

        .mode-single .section-content:not(.active) {
            display: none;
        }

        /* Dual column mode */
        .mode-dual .section-row {
            grid-template-columns: 1fr 1fr;
        }

        .mode-dual .language-headers {
            grid-template-columns: 1fr 1fr;
        }

        .mode-dual .language-header:nth-child(3) {
            display: none;
        }

        .mode-dual .section-content:nth-child(n+2):nth-child(-n+3) {
            display: block;
        }

        .mode-dual .section-content:nth-child(4) {
            display: none;
        }

        /* Triple column mode - all visible */
        .mode-triple .section-row {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .mode-triple .language-headers {
            grid-template-columns: 1fr 1fr 1fr;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">Coding Interview Prep</h1>
    </div>

    <div class="controls">
        <div class="mode-display" id="mode-display">Java</div>
        <div class="help-text">A/D to switch • W/S to navigate</div>
        <div class="status" id="status">Loading...</div>
    </div>

    <div class="content-container">
        <div class="language-headers">
            <div class="language-header">Java</div>
            <div class="language-header">JavaScript</div>
            <div class="language-header">C#</div>
        </div>
        <div id="sections-container">
            <div class="loading">Loading content...</div>
        </div>
    </div>

    <script>
        class CheatSheetViewer {
            constructor() {
                this.languages = [
                    { id: 'java', name: 'Java', file: 'shortcuts/java-shortcuts.md' },
                    { id: 'javascript', name: 'JavaScript', file: 'shortcuts/javascript-shortcuts.md' },
                    { id: 'csharp', name: 'C#', file: 'shortcuts/csharp-shortcuts.md' }
                ];

                this.modes = ['single', 'dual', 'triple'];
                this.currentModeIndex = 2; // Start with triple mode
                this.currentLanguageIndex = 0;
                this.currentSectionIndex = 0;
                this.loadedContent = {};
                this.sections = {};
                this.sectionElements = [];

                this.elements = {
                    container: document.querySelector('.content-container'),
                    sectionsContainer: document.getElementById('sections-container'),
                    modeDisplay: document.getElementById('mode-display'),
                    status: document.getElementById('status'),
                    languageHeaders: document.querySelector('.language-headers')
                };

                this.init();
            }

            async init() {
                try {
                    await this.loadAllContent();
                    this.parseContentIntoSections();
                    this.renderSections();
                    this.setupEventListeners();
                    this.updateDisplay();
                    
                    // Set initial section status
                    if (this.sectionElements.length > 0) {
                        const firstSectionTitle = this.sectionElements[0].querySelector('.section-header').textContent;
                        this.elements.status.textContent = `${firstSectionTitle} (1/${this.sectionElements.length})`;
                    } else {
                        this.elements.status.textContent = 'Ready';
                    }
                } catch (error) {
                    this.showError(error);
                }
            }

            async loadAllContent() {
                const loadPromises = this.languages.map(async (lang) => {
                    try {
                        const response = await fetch(lang.file);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        const text = await response.text();
                        this.loadedContent[lang.id] = text;
                    } catch (error) {
                        throw new Error(`Failed to load ${lang.file}: ${error.message}`);
                    }
                });

                await Promise.all(loadPromises);
            }

            parseContentIntoSections() {
                // Parse each language's markdown into sections
                this.languages.forEach(lang => {
                    this.sections[lang.id] = this.parseMarkdownSections(this.loadedContent[lang.id]);
                });
            }

            parseMarkdownSections(markdown) {
                const sections = [];
                const lines = markdown.split('\n');
                let currentSection = null;
                let currentContent = [];

                for (let line of lines) {
                    if (line.startsWith('## ')) {
                        // Save previous section
                        if (currentSection) {
                            sections.push({
                                title: currentSection,
                                content: currentContent.join('\n').trim()
                            });
                        }
                        
                        // Start new section
                        currentSection = line.substring(3).trim();
                        currentContent = [];
                    } else if (currentSection) {
                        currentContent.push(line);
                    }
                }

                // Save last section
                if (currentSection) {
                    sections.push({
                        title: currentSection,
                        content: currentContent.join('\n').trim()
                    });
                }

                return sections;
            }

            renderSections() {
                const container = this.elements.sectionsContainer;
                container.innerHTML = '';
                this.sectionElements = [];

                // Get all unique section titles
                const allSectionTitles = new Set();
                this.languages.forEach(lang => {
                    this.sections[lang.id].forEach(section => {
                        allSectionTitles.add(section.title);
                    });
                });

                // Create rows for each section
                Array.from(allSectionTitles).forEach((sectionTitle, index) => {
                    const sectionRow = document.createElement('div');
                    sectionRow.className = 'section-row';
                    sectionRow.setAttribute('data-section-index', index);

                    // Add section header
                    const header = document.createElement('div');
                    header.className = 'section-header';
                    header.textContent = sectionTitle;
                    sectionRow.appendChild(header);

                    // Add content for each language
                    this.languages.forEach((lang, langIndex) => {
                        const sectionData = this.sections[lang.id].find(s => s.title === sectionTitle);
                        const contentDiv = document.createElement('div');
                        contentDiv.className = `section-content ${lang.id}-content`;
                        contentDiv.setAttribute('data-lang', lang.id);
                        contentDiv.setAttribute('data-index', langIndex);

                        if (sectionData) {
                            contentDiv.innerHTML = marked.parse(sectionData.content);
                        } else {
                            contentDiv.innerHTML = '<p style="color: var(--text-secondary); font-style: italic;">No content for this section</p>';
                        }

                        sectionRow.appendChild(contentDiv);
                    });

                    container.appendChild(sectionRow);
                    this.sectionElements.push(sectionRow);
                });

                // Apply syntax highlighting
                hljs.highlightAll();
            }

            setupEventListeners() {
                document.addEventListener('keydown', (e) => {
                    if (e.key.toLowerCase() === 'a') {
                        e.preventDefault();
                        this.switchMode(-1);
                    } else if (e.key.toLowerCase() === 'd') {
                        e.preventDefault();
                        this.switchMode(1);
                    } else if (e.key.toLowerCase() === 'w') {
                        e.preventDefault();
                        this.navigateSection(-1);
                    } else if (e.key.toLowerCase() === 's') {
                        e.preventDefault();
                        this.navigateSection(1);
                    }
                });
            }

            navigateSection(direction) {
                if (this.sectionElements.length === 0) return;
                
                this.currentSectionIndex = Math.max(0, 
                    Math.min(this.sectionElements.length - 1, 
                        this.currentSectionIndex + direction));
                
                const targetSection = this.sectionElements[this.currentSectionIndex];
                if (targetSection) {
                    // Calculate offset to account for sticky headers
                    const headerHeight = document.querySelector('.header').offsetHeight;
                    const languageHeadersHeight = document.querySelector('.language-headers').offsetHeight;
                    const totalHeaderHeight = headerHeight + languageHeadersHeight + 20; // Extra padding
                    
                    const targetPosition = targetSection.offsetTop - totalHeaderHeight;
                    
                    window.scrollTo({
                        top: Math.max(0, targetPosition),
                        behavior: 'smooth'
                    });
                    
                    // Update status to show current section
                    const sectionTitle = targetSection.querySelector('.section-header').textContent;
                    this.elements.status.textContent = `${sectionTitle} (${this.currentSectionIndex + 1}/${this.sectionElements.length})`;
                }
            }

            switchMode(direction) {
                const currentMode = this.modes[this.currentModeIndex];
                
                if (currentMode === 'single') {
                    if (direction > 0) {
                        this.currentLanguageIndex = (this.currentLanguageIndex + 1) % this.languages.length;
                        if (this.currentLanguageIndex === 0) {
                            this.currentModeIndex = (this.currentModeIndex + 1) % this.modes.length;
                        }
                    } else {
                        if (this.currentLanguageIndex > 0) {
                            this.currentLanguageIndex--;
                        } else {
                            this.currentModeIndex = (this.currentModeIndex - 1 + this.modes.length) % this.modes.length;
                            this.currentLanguageIndex = this.languages.length - 1;
                        }
                    }
                } else {
                    if (direction > 0) {
                        this.currentModeIndex = (this.currentModeIndex + 1) % this.modes.length;
                    } else {
                        this.currentModeIndex = (this.currentModeIndex - 1 + this.modes.length) % this.modes.length;
                    }
                }

                this.updateDisplay();
            }

            updateDisplay() {
                const currentMode = this.modes[this.currentModeIndex];
                
                // Update container class
                this.elements.container.className = `content-container mode-${currentMode}`;
                
                // Update active classes for single mode
                if (currentMode === 'single') {
                    // Update language headers
                    const headers = this.elements.languageHeaders.querySelectorAll('.language-header');
                    headers.forEach((header, index) => {
                        header.classList.toggle('active', index === this.currentLanguageIndex);
                    });

                    // Update section contents
                    const allContents = document.querySelectorAll('.section-content');
                    allContents.forEach(content => {
                        const langIndex = parseInt(content.getAttribute('data-index'));
                        content.classList.toggle('active', langIndex === this.currentLanguageIndex);
                    });
                } else {
                    // Remove active classes for multi-column modes
                    document.querySelectorAll('.language-header, .section-content').forEach(el => {
                        el.classList.remove('active');
                    });
                }

                // Update mode display text
                let displayText;
                switch (currentMode) {
                    case 'single':
                        displayText = this.languages[this.currentLanguageIndex].name;
                        break;
                    case 'dual':
                        displayText = 'Java + JavaScript';
                        break;
                    case 'triple':
                        displayText = 'All Languages';
                        break;
                }
                this.elements.modeDisplay.textContent = displayText;

                // Re-apply syntax highlighting
                setTimeout(() => hljs.highlightAll(), 100);
            }

            showError(error) {
                const errorHtml = `
                    <div class="error">
                        <h3>⚠️ Failed to Load Content</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p><strong>Expected files:</strong></p>
                        <ul>
                            ${this.languages.map(lang => `<li>${lang.file}</li>`).join('')}
                        </ul>
                        <p>Make sure these markdown files exist in the shortcuts directory relative to the HTML file.</p>
                        <p><strong>Debug:</strong> Current page URL: ${window.location.href}</p>
                    </div>
                `;

                this.elements.sectionsContainer.innerHTML = errorHtml;
                this.elements.status.textContent = 'Error loading files';
                console.error('CheatSheetViewer Error:', error);
            }
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CheatSheetViewer();
        });
    </script>
</body>
</html>